const articlesData = [
    {
        title: "2026년 대변화: 새로운 카테고리 기반 선발(Category-based) 안내",
        badge: "긴급 뉴스",
        date: "2026년 2월 25일",
        content: `
            <p>IRCC는 2026년 익스프레스 엔트리 운영 방침을 공식 발표하며, 캐나다 경제의 지속 가능한 성장과 특정 분야의 인력 부족을 해결하기 위해 기존 직군을 넘어선 <b>4대 핵심 전략 카테고리</b>를 새롭게 추가했습니다. 이번 발표의 핵심은 단순히 CRS 점수가 높은 인재를 뽑는 것을 넘어, 캐나다 사회가 실제로 필요로 하는 전문 기술을 가진 인력을 우선적으로 확보하겠다는 의지입니다.</p>
            <p>기존의 일반 선발(All-program draw) 방식에서는 CRS 점수 500점 이상의 고득점자만이 초청장을 받을 수 있었으나, 새로운 카테고리 기반 선발 시스템 하에서는 해당 직군에 속하는 신청자들에 한해 훨씬 낮은 점수 커트라인에서도 초청장(ITA) 수령이 가능해질 전망입니다. 2026년 집중 관리되는 4대 카테고리는 다음과 같습니다:</p>
            <ul>
                <li><b>연구 및 교육(Academic/Research):</b> 캐나다 내 대학이나 연구 기관에서 최소 1년 이상의 경력을 쌓은 연구자, 교수, 그리고 전문 강사진이 포함됩니다. 캐나다는 글로벌 연구 경쟁력을 높이기 위해 이들의 정착을 적극 지원합니다.</li>
                <li><b>전략 경영(Senior Management):</b> 캐나다 현지 기업에서 의사결정 권한을 가진 시니어 매니저 직군입니다. 기업 운영의 영속성과 혁신을 이끌 리더급 인재를 확보하는 것이 목표입니다.</li>
                <li><b>운송(Transport):</b> 만성적인 인력 부족을 겪고 있는 항공 분야의 파일럿, 항공기 정비사뿐만 아니라 물류 시스템 전반의 핵심 기술 인력이 포함됩니다.</li>
                <li><b>국방 및 군 기술(Military):</b> 국방 현대화와 군사 기술 경쟁력 강화를 위해 군 관련 숙련 직군 및 특수 기술 전문가를 영주권 우선 순위로 배치했습니다.</li>
            </ul>
            <p>이러한 변화는 본인의 CRS 점수가 현재 커트라인에 미치지 못하더라도, 본인의 전문 분야가 위 카테고리에 해당한다면 영주권 취득의 기회가 훨씬 넓어졌음을 의미합니다. 따라서 신청자들은 본인의 NOC 코드를 재확인하고 해당 카테고리 선발 일정에 맞춰 프로필을 최신화하는 전략이 필요합니다.</p>
        `
    },
    {
        title: "캐나다 경력 연구자 및 교수진을 위한 우선권",
        badge: "연구직",
        date: "2026년 2월 24일",
        content: `
            <p>캐나다 정부는 글로벌 기술 패권 경쟁 시대에 맞춰 고도의 지식을 갖춘 학술 인재들을 유치하기 위해 '캐나다 경력 연구자 및 교수진' 전용 카테고리를 2026년 전략 카테고리에 포함시켰습니다. 이는 캐나다 내 대학이나 공공 연구소에서 연구 경력을 쌓은 전문가들이 복잡한 일반 점수 경쟁 없이도 안정적으로 정착할 수 있도록 돕기 위한 조치입니다.</p>
            <p>특히 이번 업데이트에서는 단순히 박사 학위 소지 여부뿐만 아니라, 캐나다 현지에서의 고용 이력(Work Experience)과 연구 실적이 점수 산정 및 선발에 결정적인 역할을 하게 됩니다. 대학 교수는 물론, 포스트닥터(Post-doc) 과정의 연구원이나 특정 기술 분야의 전문 강사진도 해당 카테고리를 통해 혜택을 볼 수 있습니다.</p>
            <p>전문가들은 "캐나다 내에서의 연구 경력이 있다면 기존 CRS 시스템에서 깎였던 나이 점수 등의 불이익을 상쇄할 만큼 강력한 가산점을 받는 효과를 누릴 것"이라고 분석하고 있습니다. 연구직 종사자들은 본인의 연구 분야가 캐나다 정부가 공표한 핵심 기술 목록에 포함되는지 확인하고, 관련 경력 증명 서류를 미리 준비하는 것이 좋습니다.</p>
        `
    },
    {
        title: "시니어 매니저(Senior Manager) 전형 분석",
        badge: "매니지먼트",
        date: "2026년 2월 23일",
        content: `
            <p>캐나다 경제의 중추 역할을 하는 기업들의 리더십 공백을 메우기 위해 '시니어 매니저(Senior Manager)' 직군이 카테고리 기반 선발의 새로운 한 축으로 등장했습니다. 이는 캐나다 내에서 일정 규모 이상의 기업을 운영하거나 주요 부서를 책임졌던 관리자들에게 영주권 취득의 패스트트랙을 제공하겠다는 의미입니다.</p>
            <p>NOC TEER 0 등급 중에서도 기업 경영, 재무 관리, 인사 전략 등 고도의 전문성을 요하는 직종들이 주요 대상입니다. IRCC는 "단순히 관리자 타이틀을 가졌다고 해서 모두 선발되는 것이 아니라, 캐나다 노동 시장에 기여한 실질적인 성과와 경력 기간을 엄격히 심사할 것"이라고 밝혔습니다.</p>
            <p>시니어 매니저 전형의 장점은 일반 기술직군에 비해 커트라인 점수가 유연하게 적용될 수 있다는 점입니다. 기업의 후원을 받거나(LMIA), 캐나다 지사 발령 등으로 이미 현지에서 관리직으로 근무 중인 신청자들에게는 2026년이 영주권 취득의 최적기가 될 것입니다. 본인의 직무 기술서(Job Description)가 TEER 0 등급의 요구 사항과 정확히 일치하는지 전문가의 검토를 받는 것이 중요합니다.</p>
        `
    },
    {
        title: "항공 및 운송 전문 인력의 기회",
        badge: "운송직",
        date: "2026년 2월 22일",
        content: `
            <p>캐나다 전역의 물류 네트워크와 항공 산업을 지탱할 '운송 전문 인력'을 위한 문호가 더욱 넓어집니다. 2026년 카테고리 기반 선발에서 운송 직군은 가장 높은 빈도로 드로우(Draw)가 시행될 것으로 예상되는 분야 중 하나입니다. 이는 캐나다의 지리적 특성상 항공 및 육상 운송의 효율성이 국가 경쟁력과 직결되기 때문입니다.</p>
            <p>주요 선발 대상은 상업용 파일럿, 항공기 정비 전문가, 선박 조종사, 그리고 물류 체계의 효율화를 담당하는 전문 기술자들입니다. 특히 파일럿과 정비사의 경우, 국제적인 자격 요건과 캐나다 내에서의 실무 경험이 결합될 경우 CRS 점수가 다소 낮더라도 우선적으로 초청장(ITA)을 받을 수 있는 확률이 매우 높습니다.</p>
            <p>업계 관계자들은 "캐나다 항공 산업의 재도약과 함께 관련 인력 수요가 폭증하고 있으며, 정부 역시 이들을 정착시키기 위해 전례 없는 혜택을 제공하고 있다"고 전했습니다. 운송 직군 종사자들은 본인이 보유한 국제 자격증의 캐나다 내 환산 절차를 서두르고, 최소 6개월 이상의 캐나다 내 연속 경력을 확보하는 것이 합격의 열쇠가 될 것입니다.</p>
        `
    },
    {
        title: "군 관련 숙련직(Military) 신규 카테고리",
        badge: "국방",
        date: "2026년 2월 21일",
        content: `
            <p>2026년 익스프레스 엔트리 업데이트 중 가장 이례적이고 파격적인 항목은 바로 '군 관련 숙련직(Military)' 카테고리의 신설입니다. 캐나다는 국가 방위 역량 강화와 첨단 국방 기술 인재 확보를 위해 군사 기술 전문가들에게 영주권 신청 시 강력한 우선권을 부여하기로 결정했습니다.</p>
            <p>해당 카테고리에는 군사 장비 정비, 사이버 보안 전문가, 특수 통신 기술자 등 국방 분야와 밀접하게 연관된 기술을 보유한 인력들이 포함됩니다. 이는 기존에 민간 분야 경력만을 인정하던 시스템에서 벗어나, 군에서의 특수 경력을 캐나다 경제 및 사회의 자산으로 인정하겠다는 획기적인 발상의 전환입니다.</p>
            <p>국방 분야 기술 보유자들은 일반적인 CRS 경쟁과는 다른 트랙에서 심사를 받게 되며, 이는 상대적으로 낮은 영어 성적이나 학력을 가졌더라도 본인의 특수 기술만으로 영주권 취득이 가능하다는 것을 의미합니다. 군 경력을 가진 신청자들은 본인의 주특기 번호(MOS)와 연관된 NOC 코드를 정교하게 매칭하여 프로필을 등록해야 하며, 국방 기술의 특수성을 증명할 수 있는 보조 자료 준비에 만전을 기해야 합니다.</p>
        `
    },
    {
        title: "프랑스어 능력의 엄청난 혜택 (2026 유지)",
        badge: "프랑스어",
        date: "2026년 2월 20일",
        content: `
            <p>2026년에도 프랑스어 우수자(French-language proficiency) 카테고리는 모든 전략 카테고리 중에서 가장 낮은 CRS 커트라인과 가장 많은 선발 인원을 유지할 것으로 보입니다. 캐나다 정부는 퀘벡 주 외 지역의 불어 사용 인구 비중을 높이기 위해 프랑스어 구사자들에게 파격적인 혜택을 지속적으로 제공하고 있습니다.</p>
            <p>프랑스어 능력 시험(TEF Canada 또는 TCF Canada)에서 일정 수준(CLB 7 이상)을 달성할 경우, 단순히 언어 점수를 받는 것을 넘어 '프랑스어 전용 선발 드로우'에 참여할 수 있는 자격이 주어집니다. 2025년 통계에 따르면 프랑스어 전용 선발의 커트라인은 일반 선발보다 평균 100점 이상 낮게 형성되었습니다.</p>
            <p>특히 영어가 CLB 9 이상인 고득점자가 프랑스어 성적까지 보유할 경우, '조합 점수(Combination Points)'로 최대 50점의 추가 점수를 받을 수 있어 사실상 영주권 취득이 확실시됩니다. 불어 공부가 단기적으로는 어려울 수 있으나, 2026년 캐나다 영주권이라는 목표를 달성하기 위한 가장 확실하고 강력한 무기라는 점은 변함이 없습니다.</p>
        `
    }
];

// --- 기사 모달 제어 ---
window.openArticle = function(index) {
    const article = articlesData[index];
    if (!article) return;

    const modal = document.getElementById("articleModal");
    const modalBody = document.getElementById("modalBody");
    if (!modal || !modalBody) return;

    modalBody.innerHTML = `
        <span class="article-badge">${article.badge}</span>
        <h2>${article.title}</h2>
        <div class="article-meta">${article.date}</div>
        <div class="full-content">${article.content}</div>
        <button class="read-more-btn" style="margin-top:30px; width:100%" id="modalCloseBtn">닫기</button>
    `;

    modal.style.display = "block";
    document.body.classList.add("modal-open"); // 클래스로 제어

    document.getElementById("modalCloseBtn").onclick = window.closeArticle;
};

window.closeArticle = function() {
    const modal = document.getElementById("articleModal");
    if (modal) {
        modal.style.display = "none";
        document.body.classList.remove("modal-open"); // 클래스 제거
    }
};

// --- 초기화 로직 ---
document.addEventListener('DOMContentLoaded', () => {
    // 1. 네비게이션 효과
    const nav = document.getElementById('mainNav');
    window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
            nav.style.padding = '8px 20px';
            nav.style.top = '10px';
        } else {
            nav.style.padding = '12px 30px';
            nav.style.top = '20px';
        }
    });

    // 2. 테마 설정
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        if (document.documentElement.getAttribute('data-theme') === 'dark') {
            themeToggle.textContent = '☀️ 라이트 모드';
        }
        themeToggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeToggle.textContent = theme === 'dark' ? '☀️ 라이트 모드' : '🌙 다크 모드';
        });
    }

    // 3. 커뮤니티 렌더링
    renderPosts();

    // 4. 모달 닫기 이벤트 (바깥 클릭 및 ESC 키)
    window.addEventListener('click', (e) => {
        const modal = document.getElementById("articleModal");
        if (e.target === modal) window.closeArticle();
    });

    window.addEventListener('keydown', (e) => {
        if (e.key === "Escape") window.closeArticle();
    });
});

// --- CRS 계산기 ---
function toggleSpouseSection() {
    const status = document.getElementById('maritalStatus').value;
    const spouseSection = document.getElementById('spouseSection');
    if(spouseSection) spouseSection.style.display = status === 'married' ? 'block' : 'none';
}

function calculateCRS() {
    const status = document.getElementById('maritalStatus').value;
    const isMarried = (status === 'married');
    
    let age = parseInt(document.getElementById("age").value) || 0;
    let education = document.getElementById("education").value;
    let language = parseInt(document.getElementById("language").value) || 0;
    let canadianExp = parseInt(document.getElementById("canadianExp").value) || 0;
    let foreignExp = parseInt(document.getElementById("foreignExp").value) || 0;

    let total = 0;
    let agePoints = 0;
    if (age >= 20 && age <= 29) agePoints = isMarried ? 100 : 110;
    else if (age >= 30 && age <= 44) {
        let base = isMarried ? 100 : 110;
        let deduct = isMarried ? 5 : 6;
        agePoints = base - ((age - 29) * deduct);
    }
    total += Math.max(0, agePoints);

    const eduMap = { 'highschool': isMarried ? 28 : 30, 'bachelor': isMarried ? 112 : 120, 'two_or_more': isMarried ? 119 : 128, 'master': isMarried ? 126 : 135, 'phd': isMarried ? 140 : 150 };
    total += eduMap[education] || 0;

    const langMap = { 7: isMarried ? 64 : 68, 8: isMarried ? 88 : 92, 9: isMarried ? 116 : 124, 10: isMarried ? 128 : 136 };
    total += langMap[language] || 0;

    const canExpMap = { 1: isMarried ? 35 : 40, 2: isMarried ? 46 : 53, 3: isMarried ? 70 : 80 };
    total += canExpMap[canadianExp] || 0;

    let transfer = 0;
    if (education !== 'highschool' && education !== '0') {
        if (language >= 9) transfer += 50;
        else if (language >= 7) transfer += 25;
    }
    if (foreignExp >= 1) {
        if (language >= 9) transfer += (foreignExp >= 3 ? 50 : 25);
        else if (language >= 7) transfer += (foreignExp >= 3 ? 25 : 13);
    }
    total += Math.min(100, transfer);

    if (isMarried) {
        const sEdu = document.getElementById("spouseEducation").value;
        const sLang = parseInt(document.getElementById("spouseLanguage").value) || 0;
        if (sEdu === 'bachelor') total += 8; else if (sEdu === 'master') total += 10;
        if (sLang >= 9) total += 20; else if (sLang >= 7) total += 12;
    }

    const res = document.getElementById("crsResult");
    res.querySelector('.result-score').innerText = total + "점";
    res.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function addPost() {
    let t = document.getElementById("title");
    let c = document.getElementById("content");
    if(!t.value || !c.value) return;
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.push({title: t.value, content: c.value});
    localStorage.setItem("posts", JSON.stringify(posts));
    t.value = ""; c.value = "";
    renderPosts();
}

function renderPosts() {
    let list = document.getElementById("blogList");
    if(!list) return;
    list.innerHTML = "";
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.reverse().forEach(p => {
        let d = document.createElement("div");
        d.className = "blog-post card";
        d.style.padding = "20px";
        d.innerHTML = `<h3>${p.title}</h3><p>${p.content}</p>`;
        list.appendChild(d);
    });
}
