const articlesData = [
    {
        title: "2026년 익스프레스 엔트리 대개혁: 카테고리 기반 선발 시스템 심층 분석",
        badge: "정책 분석",
        date: "2026년 2월 25일",
        content: `
            <p>캐나다 이민성(IRCC)은 2026년 운영 계획을 통해 익스프레스 엔트리 시스템 도입 이래 가장 파격적인 변화를 공표했습니다. 핵심은 'CRS 점수 지상주의'에서 벗어나, 캐나다의 실제 경제 성장 동력과 직결되는 <b>'카테고리 기반 선발(Category-based Selection)'</b>의 비중을 전체 선발 인원의 70% 이상으로 확대하는 것입니다.</p>
            <h3>1. 왜 이러한 변화가 일어나는가?</h3>
            <p>기존 시스템은 높은 영어 성적과 학력을 가진 고득점자를 양산했지만, 정작 캐나다 노동 시장이 절실히 필요로 하는 특정 기술 인력은 높은 CRS 커트라인에 막혀 입국하지 못하는 모순이 발생했습니다. IRCC는 이를 해결하기 위해 국가 전략 산업과 연계된 4개 직군 카테고리를 신설하여, 점수가 다소 낮더라도 실무 능력이 검증된 인재를 우선적으로 선발하겠다는 강력한 의지를 보이고 있습니다.</p>
            <h3>2. 2026년 4대 신규 집중 선발 카테고리</h3>
            <ul>
                <li><b>연구 및 교육(Academic/Research):</b> 단순 학위 소지자가 아닌, 캐나다 내 연구소나 대학에서 실질적인 기여를 한 인재를 목표로 합니다.</li>
                <li><b>전략 경영(Senior Management):</b> 캐나다 현지 기업의 혁신을 주도할 수 있는 의사결정권자 그룹입니다.</li>
                <li><b>운송 및 물류(Transport):</b> 글로벌 공급망 병목 현상을 해결할 핵심 기술 인력입니다.</li>
                <li><b>국방 및 특수 기술(Military):</b> 국가 안보와 직결된 특수 기술직군으로, 2026년 처음으로 단독 카테고리화 되었습니다.</li>
            </ul>
            <h3>3. 신청자를 위한 필승 전략</h3>
            <p>이제는 단순히 점수를 1~2점 올리는 것보다, 본인의 경력이 어떤 카테고리에 포함되는지를 정교하게 분석하는 것이 중요합니다. 특히 본인의 NOC(National Occupational Classification) 코드가 신규 카테고리의 세부 직종 리스트에 포함되어 있는지 확인하고, 해당 카테고리 전용 드로우(Draw)가 열리는 시기를 예측하여 프로필을 미리 등록해 두는 '타이밍 전략'이 필수적입니다.</p>
        `
    },
    {
        title: "캐나다 경력 연구자 및 교수진(Academic) 영주권 취득 로드맵",
        badge: "전문 가이드",
        date: "2026년 2월 24일",
        content: `
            <p>캐나다는 지식 기반 경제로의 전환을 가속화하기 위해 전 세계의 우수한 학술 인재들을 유치하는 데 사활을 걸고 있습니다. 특히 2026년부터 시행되는 '연구자 전용 카테고리'는 캐나다 내 대학(DLI)이나 공공 및 민간 연구소에서 경력을 쌓은 분들에게 전례 없는 기회를 제공합니다.</p>
            <h3>1. 주요 대상 직종 및 NOC 코드</h3>
            <p>이 카테고리에는 대학 교수(NOC 4011), 박사 후 연구원(NOC 4012), 과학 연구원, 그리고 특정 기술 분야의 전문 강사진이 포함됩니다. 중요한 점은 단순히 학문적 성과뿐만 아니라, 캐나다 내에서의 고용 이력이 있다면 매우 유리한 고지를 점할 수 있습니다.</p>
            <h3>2. 연구직 전형의 핵심 차별점</h3>
            <p>일반 FSW(Federal Skilled Worker) 프로그램에서는 나이 점수 감점이 뼈아픈 30대 후반~40대 연구자들에게 이 카테고리는 구원투수와 같습니다. 카테고리 선발에서는 나이보다는 '연구 분야의 희소성'과 '캐나다 내 기여도'를 우선시하기 때문에, 일반 커트라인보다 50~80점 낮은 점수로도 ITA를 받을 수 있는 구조입니다.</p>
            <h3>3. 전문가 조언: 논문보다 중요한 '실무 증명'</h3>
            <p>영주권 심사관들은 당신의 논문 인용 횟수보다 당신이 캐나다 노동 시장에서 얼마나 대체 불가능한 인력인지를 봅니다. 따라서 경력 증명서 작성 시 본인의 연구가 캐나다의 특정 산업에 미치는 영향을 구체적으로 기술하는 것이 핵심입니다.</p>
        `
    },
    {
        title: "시니어 매니저(Senior Manager)를 위한 전략적 이민 가이드",
        badge: "경영 전략",
        date: "2026년 2월 23일",
        content: `
            <p>2026년 IRCC가 도입한 '시니어 매니저 전형'은 글로벌 기업의 리더들이 캐나다에 자본과 경영 노하우를 가지고 정착하도록 유도하기 위한 전략적 선택입니다. 이는 경영진급 인력에게 사실상의 '레드 카펫'을 깔어주는 것과 다름없습니다.</p>
            <h3>1. TEER 0 등급 시니어 매니저의 정의</h3>
            <p>단순한 부서장 급을 넘어, 기업의 재무, 인사, 운영 전반에 걸쳐 최종 의사결정권을 가진 직군(NOC 00012, 00013 등)이 주요 타겟입니다. IRCC는 이들이 캐나다 현지 법인을 설립하거나 기존 기업의 성장을 주도하여 일자리를 창출할 것으로 기대하고 있습니다.</p>
            <h3>2. 왜 지금이 적기인가?</h3>
            <p>캐나다 내 많은 중견 기업들이 경영진의 세대교체 시기를 맞이하고 있으며, 이를 해외 우수 인력으로 수혈하려는 정책적 움직임이 강합니다. 특히 주정부 이민(PNP)과 연계될 경우, 시니어 매니저는 가장 높은 우선순위로 처리되며 비자 발급 속도 또한 다른 직군에 비해 비약적으로 빠릅니다.</p>
            <h3>3. 준비 사항: 성과 중심의 포트폴리오</h3>
            <p>이 전형에서는 본인이 관리한 예산 규모, 팀 사이즈, 그리고 달성한 구체적인 비즈니스 성과를 데이터로 증명해야 합니다. 전문 컨설턴트와 함께 본인의 경력을 '캐나다 경제 기여도' 관점에서 재해석하시기 바랍니다.</p>
        `
    },
    {
        title: "2026 항공 및 운송 기술직: 공급망 위기 해결의 핵심 인재",
        badge: "산업 리포트",
        date: "2026년 2월 22일",
        content: `
            <p>캐나다의 광활한 영토와 북미 물류 허브로서의 지위를 유지하기 위해, 항공 및 운송 직군은 2026년 카테고리 기반 선발에서 가장 비중 있게 다뤄질 전망입니다. 물류 대란을 겪으며 운송 인력의 중요성을 절감한 캐나다 정부는 이들에게 영주권 수령의 가장 빠른 경로를 제공하고 있습니다.</p>
            <h3>1. 집중 선발 대상: 파일럿에서 정비사까지</h3>
            <p>상업용 항공기 조종사(NOC 72600), 항공기 정비사(NOC 72404), 철도 운행 관제사, 그리고 스마트 물류 시스템 전문가들이 핵심 대상입니다.</p>
            <h3>2. 성공 전략: 자격증 환산과 연속 경력</h3>
            <p>해외 자격증을 캐나다 자격증(TC)으로 전환하는 절차를 입국 전 미리 완료하는 것이 중요합니다. 또한, 캐나다 내에서의 최소 6개월 이상 연속 근무 경력은 카테고리 선발 시 강력한 가점 요인이 됩니다.</p>
        `
    },
    {
        title: "국방 및 군사 기술직(Military) 신설 카테고리 완벽 분석",
        badge: "신규 전형",
        date: "2026년 2월 21일",
        content: `
            <p>2026년 익스프레스 엔트리의 가장 놀라운 뉴스 중 하나는 '군 관련 숙련직' 전용 카테고리의 탄생입니다. 이는 캐나다가 국가 안보와 첨단 국방 기술 경쟁력을 확보하기 위해 군사 기술 인재들에게 시민권으로 가는 문을 활짝 열었음을 의미합니다.</p>
            <h3>1. 이례적인 혜택: 군 경력의 자산화</h3>
            <p>이제는 군에서의 특수 기술(통신, 사이버 보안, 특수 장비 정비 등)이 캐나다 경제와 안보에 기여하는 핵심 자산으로 인정받습니다. 특히 우방국 군 경력 소지자나 첨단 방산 기술 보유자에게는 매우 높은 가점이 부여됩니다.</p>
        `
    },
    {
        title: "프랑스어 우수자 전형: 2026년에도 영주권 취득의 '치트키'",
        badge: "언어 전략",
        date: "2026년 2월 20일",
        content: `
            <p>캐나다 연방 정부는 퀘벡주를 제외한 나머지 주들의 불어 사용 인구 비율을 높이기 위해 불어 구사자들에게 엄청난 특혜를 쏟아붓고 있습니다. 실제로 불어 전용 드로우의 커트라인은 모든 전형을 통틀어 가장 낮습니다.</p>
            <h3>1. 50점 가산점 그 이상의 가치</h3>
            <p>프랑스어 능력(CLB 7 이상)을 증명하면 기존 CRS 점수에서 50점을 추가로 받을 뿐만 아니라, 일반 선발보다 훨씬 유리한 '프랑스어 전용 선발 풀'에 자동으로 입장하게 됩니다.</p>
        `
    }
];

// --- NOC 데이터 ---
const nocData = [
    { code: "00010", title: "Legislators", teer: "0", cat: "" },
    { code: "00011", title: "Senior government managers and officials", teer: "0", cat: "" },
    { code: "00012", title: "Senior managers - financial, communications", teer: "0", cat: "Management" },
    { code: "00013", title: "Senior managers - health, education", teer: "0", cat: "Management" },
    { code: "00014", title: "Senior managers - trade, broadcasting", teer: "0", cat: "Management" },
    { code: "00015", title: "Senior managers - construction, transport", teer: "0", cat: "Management" },
    { code: "10010", title: "Financial managers", teer: "0", cat: "" },
    { code: "10011", title: "Human resources managers", teer: "0", cat: "" },
    { code: "10012", title: "Purchasing managers", teer: "0", cat: "" },
    { code: "11100", title: "Financial auditors and accountants", teer: "1", cat: "" },
    { code: "11101", title: "Financial and investment analysts", teer: "1", cat: "" },
    { code: "12100", title: "Administrative officers", teer: "2", cat: "" },
    { code: "12101", title: "Executive assistants", teer: "2", cat: "" },
    { code: "21211", title: "Data scientists", teer: "1", cat: "STEM" },
    { code: "21220", title: "Cybersecurity specialists", teer: "1", cat: "STEM" },
    { code: "21231", title: "Software engineers and designers", teer: "1", cat: "STEM" },
    { code: "21232", title: "Software developers and programmers", teer: "1", cat: "STEM" },
    { code: "21233", title: "Web designers", teer: "1", cat: "STEM" },
    { code: "21234", title: "Web developers and programmers", teer: "1", cat: "STEM" },
    { code: "21300", title: "Civil engineers", teer: "1", cat: "STEM" },
    { code: "21301", title: "Mechanical engineers", teer: "1", cat: "STEM" },
    { code: "21310", title: "Electrical and electronics engineers", teer: "1", cat: "STEM" },
    { code: "31100", title: "Specialists in clinical and laboratory medicine", teer: "1", cat: "Healthcare" },
    { code: "31102", title: "General practitioners and family physicians", teer: "1", cat: "Healthcare" },
    { code: "31301", title: "Registered nurses and registered psychiatric nurses", teer: "1", cat: "Healthcare" },
    { code: "32101", title: "Licensed practical nurses", teer: "2", cat: "Healthcare" },
    { code: "40110", title: "University professors and lecturers", teer: "1", cat: "Academic" },
    { code: "41200", title: "University researchers", teer: "1", cat: "Academic" },
    { code: "42202", title: "Early childhood educators and assistants (ECE)", teer: "2", cat: "" },
    { code: "52120", title: "Graphic designers and illustrators", teer: "2", cat: "" },
    { code: "62200", title: "Chefs", teer: "2", cat: "Trades" },
    { code: "63200", title: "Cooks", teer: "3", cat: "Trades" },
    { code: "72106", title: "Welders and related machine operators", teer: "2", cat: "Trades" },
    { code: "72400", title: "Construction millwrights and industrial mechanics", teer: "2", cat: "Trades" },
    { code: "72404", title: "Aircraft mechanics and aircraft inspectors", teer: "2", cat: "Transport" },
    { code: "72600", title: "Air pilots, flight engineers and flying instructors", teer: "2", cat: "Transport" },
    { code: "73300", title: "Transport truck drivers", teer: "3", cat: "Transport" }
];

window.filterNOC = function() {
    const input = document.getElementById('nocSearchInput').value.toLowerCase().trim();
    const resultsContainer = document.getElementById('nocResults');
    
    if (input.length < 2) {
        resultsContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--text-muted);">검색어를 2글자 이상 입력하세요.</p>';
        return;
    }

    const filtered = nocData.filter(item => {
        const fullContent = (item.title + " " + item.code + " " + (item.cat || "")).toLowerCase();
        return fullContent.includes(input);
    });

    if (filtered.length === 0) {
        resultsContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--text-muted);">일치하는 결과가 없습니다. 영문 키워드(e.g. Developer, Cook, Engineer)나 5자리 숫자로 다시 시도해보세요.</p>';
        return;
    }

    resultsContainer.innerHTML = filtered.map(item => `
        <div class="noc-item">
            <div class="noc-header">
                <span class="noc-code">${item.code}</span>
                <span class="noc-teer">TEER ${item.teer}</span>
                ${item.cat ? `<span class="noc-cat-badge">${item.cat}</span>` : ''}
            </div>
            <div class="noc-title">${item.title}</div>
        </div>
    `).join('');
};

// --- 기사 모달 제어 ---
window.openArticle = function(index) {
    const article = articlesData[index];
    if (!article) return;

    const modal = document.getElementById("articleModal");
    const modalBody = document.getElementById("modalBody");
    if (!modal || !modalBody) return;

    modalBody.innerHTML = `
        <span class="article-badge">${article.badge}</span>
        <h2>${article.title}</h2>
        <div class="article-meta">${article.date}</div>
        <div class="full-content">${article.content}</div>
        <button class="read-more-btn" style="margin-top:30px; width:100%" id="modalCloseBtn">닫기</button>
    `;

    modal.style.display = "block";
    document.body.classList.add("modal-open");

    document.getElementById("modalCloseBtn").onclick = window.closeArticle;
};

window.closeArticle = function() {
    const modal = document.getElementById("articleModal");
    if (modal) {
        modal.style.display = "none";
        document.body.classList.remove("modal-open");
    }
};

// --- 초기화 로직 ---
document.addEventListener('DOMContentLoaded', () => {
    const nav = document.getElementById('mainNav');
    if (nav) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) {
                nav.style.padding = '8px 20px';
                nav.style.top = '10px';
            } else {
                nav.style.padding = '12px 30px';
                nav.style.top = '20px';
            }
        });
    }

    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        if (document.documentElement.getAttribute('data-theme') === 'dark') {
            themeToggle.textContent = '☀️ 라이트 모드';
        }
        themeToggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeToggle.textContent = theme === 'dark' ? '☀️ 라이트 모드' : '🌙 다크 모드';
        });
    }

    renderPosts();

    window.addEventListener('click', (e) => {
        const modal = document.getElementById("articleModal");
        if (e.target === modal) window.closeArticle();
    });

    window.addEventListener('keydown', (e) => {
        if (e.key === "Escape") window.closeArticle();
    });
});

// --- CRS 계산기 ---
function toggleSpouseSection() {
    const status = document.getElementById('maritalStatus').value;
    const spouseSection = document.getElementById('spouseSection');
    if(spouseSection) spouseSection.style.display = status === 'married' ? 'block' : 'none';
}

function calculateCRS() {
    const status = document.getElementById('maritalStatus').value;
    const isMarried = (status === 'married');
    
    const age = parseInt(document.getElementById("age").value) || 0;
    const education = document.getElementById("education").value;
    const language = parseInt(document.getElementById("language").value) || 0;
    const canadianExp = parseInt(document.getElementById("canadianExp").value) || 0;
    const foreignExp = parseInt(document.getElementById("foreignExp").value) || 0;

    const canadianStudy = parseInt(document.getElementById("canadianStudy").value) || 0;
    const pnp = parseInt(document.getElementById("pnp").value) || 0;
    const jobOffer = parseInt(document.getElementById("jobOffer").value) || 0;
    const sibling = parseInt(document.getElementById("sibling").value) || 0;
    const frenchSkill = parseInt(document.getElementById("frenchSkill").value) || 0;

    let total = 0;

    // 1. 인적 자본 점수 (Core Factors)
    let agePoints = 0;
    if (age >= 20 && age <= 29) agePoints = isMarried ? 100 : 110;
    else if (age >= 30 && age <= 44) {
        let base = isMarried ? 100 : 110;
        let deduct = isMarried ? 5 : 6;
        agePoints = base - ((age - 29) * deduct);
    }
    total += Math.max(0, agePoints);

    const eduMap = { 'highschool': isMarried ? 28 : 30, 'bachelor': isMarried ? 112 : 120, 'two_or_more': isMarried ? 119 : 128, 'master': isMarried ? 126 : 135, 'phd': isMarried ? 140 : 150 };
    total += eduMap[education] || 0;

    const langMap = { 7: isMarried ? 64 : 68, 8: isMarried ? 88 : 92, 9: isMarried ? 116 : 124, 10: isMarried ? 128 : 136 };
    total += langMap[language] || 0;

    const canExpMap = { 1: isMarried ? 35 : 40, 2: isMarried ? 46 : 53, 3: isMarried ? 70 : 80 };
    total += canExpMap[canadianExp] || 0;

    // 2. 배우자 가산점
    if (isMarried) {
        const sEdu = document.getElementById("spouseEducation").value;
        const sLang = parseInt(document.getElementById("spouseLanguage").value) || 0;
        if (sEdu === 'bachelor') total += 8; else if (sEdu === 'master') total += 10;
        if (sLang >= 9) total += 20; else if (sLang >= 7) total += 12; else if (sLang >= 5) total += 4;
    }

    // 3. 기술 전이 점수 (Skill Transferability - 최대 100점)
    let transfer = 0;
    if (education !== 'highschool' && education !== '0') {
        if (language >= 9) transfer += (education === 'master' || education === 'phd' ? 50 : 25);
        else if (language >= 7) transfer += (education === 'master' || education === 'phd' ? 25 : 13);
    }
    if (canadianExp >= 1 && foreignExp >= 1) {
        if (canadianExp >= 2) transfer += (foreignExp >= 3 ? 50 : 25);
        else transfer += (foreignExp >= 3 ? 25 : 13);
    } else if (foreignExp >= 1 && language >= 7) {
        if (language >= 9) transfer += (foreignExp >= 3 ? 50 : 25);
        else transfer += (foreignExp >= 3 ? 25 : 13);
    }
    total += Math.min(100, transfer);

    // 4. 추가 점수
    total += (canadianStudy + jobOffer + sibling + frenchSkill);
    total += pnp;

    const res = document.getElementById("crsResult");
    res.querySelector('.result-score').innerText = Math.min(1200, total) + "점";
    res.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function addPost() {
    let t = document.getElementById("title");
    let c = document.getElementById("content");
    if(!t.value || !c.value) return;
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.push({title: t.value, content: c.value});
    localStorage.setItem("posts", JSON.stringify(posts));
    t.value = ""; c.value = "";
    renderPosts();
}

function renderPosts() {
    let list = document.getElementById("blogList");
    if(!list) return;
    list.innerHTML = "";
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.reverse().forEach(p => {
        let d = document.createElement("div");
        d.className = "blog-post card";
        d.style.padding = "20px";
        d.innerHTML = `<h3>${p.title}</h3><p>${p.content}</p>`;
        list.appendChild(d);
    });
}
