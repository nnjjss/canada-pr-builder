const articlesData = [
    {
        title: "2026ë…„ ìµìŠ¤í”„ë ˆìŠ¤ ì—”íŠ¸ë¦¬ ëŒ€ê°œí˜: ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ì„ ë°œ ì‹œìŠ¤í…œ ì‹¬ì¸µ ë¶„ì„",
        badge: "ì •ì±… ë¶„ì„",
        date: "2026ë…„ 2ì›” 25ì¼",
        content: `<p>IRCCëŠ” 2026ë…„ ìµìŠ¤í”„ë ˆìŠ¤ ì—”íŠ¸ë¦¬ ìš´ì˜ ê³„íšì„ í†µí•´ 'CRS ì ìˆ˜ ì§€ìƒì£¼ì˜'ì—ì„œ ë²—ì–´ë‚˜, ìºë‚˜ë‹¤ì˜ ì‹¤ì œ ê²½ì œ ì„±ì¥ ë™ë ¥ê³¼ ì§ê²°ë˜ëŠ” <b>'ì¹´í…Œê³ ë¦¬ ê¸°ë°˜ ì„ ë°œ(Category-based Selection)'</b>ì˜ ë¹„ì¤‘ì„ ì „ì²´ ì„ ë°œ ì¸ì›ì˜ 70% ì´ìƒìœ¼ë¡œ í™•ëŒ€í•©ë‹ˆë‹¤.</p><h3>1. 2026ë…„ 4ëŒ€ ì‹ ê·œ ì§‘ì¤‘ ì„ ë°œ ì¹´í…Œê³ ë¦¬</h3><ul><li><b>ì—°êµ¬ ë° êµìœ¡(Academic/Research):</b> ìºë‚˜ë‹¤ ë‚´ ì—°êµ¬ì†Œë‚˜ ëŒ€í•™ì—ì„œ ê¸°ì—¬í•œ ì¸ì¬.</li><li><b>ì „ëµ ê²½ì˜(Senior Management):</b> ìºë‚˜ë‹¤ í˜„ì§€ ê¸°ì—…ì˜ ì˜ì‚¬ê²°ì •ê¶Œì ê·¸ë£¹.</li><li><b>ìš´ì†¡ ë° ë¬¼ë¥˜(Transport):</b> ê¸€ë¡œë²Œ ê³µê¸‰ë§ ë³‘ëª© í˜„ìƒì„ í•´ê²°í•  í•µì‹¬ ì¸ë ¥.</li><li><b>êµ­ë°© ë° íŠ¹ìˆ˜ ê¸°ìˆ (Military):</b> êµ­ê°€ ì•ˆë³´ì™€ ì§ê²°ëœ íŠ¹ìˆ˜ ê¸°ìˆ ì§êµ°.</li></ul>`
    },
    {
        title: "ìºë‚˜ë‹¤ ê²½ë ¥ ì—°êµ¬ì ë° êµìˆ˜ì§„(Academic) ì˜ì£¼ê¶Œ ì·¨ë“ ë¡œë“œë§µ",
        badge: "ì „ë¬¸ ê°€ì´ë“œ",
        date: "2026ë…„ 2ì›” 24ì¼",
        content: `<p>ìºë‚˜ë‹¤ ë‚´ ëŒ€í•™(DLI)ì´ë‚˜ ì—°êµ¬ì†Œì—ì„œ ê²½ë ¥ì„ ìŒ“ì€ ì „ë¬¸ê°€ë“¤ì—ê²Œ ì „ë¡€ ì—†ëŠ” ê¸°íšŒë¥¼ ì œê³µí•©ë‹ˆë‹¤. ëŒ€í•™ êµìˆ˜(NOC 40110), ë°•ì‚¬ í›„ ì—°êµ¬ì›(NOC 40120) ë“±ì´ ì£¼ìš” ëŒ€ìƒì´ë©°, ì¼ë°˜ ì»·ì˜¤í”„ë³´ë‹¤ í›¨ì”¬ ë‚®ì€ ì ìˆ˜ë¡œ í•©ê²©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>`
    },
    {
        title: "ì‹œë‹ˆì–´ ë§¤ë‹ˆì €(Senior Manager)ë¥¼ ìœ„í•œ ì „ëµì  ì´ë¯¼ ê°€ì´ë“œ",
        badge: "ê²½ì˜ ì „ëµ",
        date: "2026ë…„ 2ì›” 23ì¼",
        content: `<p>NOC TEER 0 ë“±ê¸‰ì˜ ì‹œë‹ˆì–´ ê²½ì˜ì§„(NOC 00012, 00013 ë“±)ì„ ìœ„í•œ íŠ¹ë³„ ì „í˜•ì…ë‹ˆë‹¤. ê¸°ì—… ìš´ì˜ ì„±ê³¼ì™€ ìºë‚˜ë‹¤ ê²½ì œ ê¸°ì—¬ë„ë¥¼ ì¦ëª…í•˜ëŠ” ê²ƒì´ í•©ê²©ì˜ í•µì‹¬ì…ë‹ˆë‹¤.</p>`
    },
    {
        title: "2026 í•­ê³µ ë° ìš´ì†¡ ê¸°ìˆ ì§: ê³µê¸‰ë§ ìœ„ê¸° í•´ê²°ì˜ í•µì‹¬ ì¸ì¬",
        badge: "ì‚°ì—… ë¦¬í¬íŠ¸",
        date: "2026ë…„ 2ì›” 22ì¼",
        content: `<p>íŒŒì¼ëŸ¿(NOC 72600), í•­ê³µ ì •ë¹„ì‚¬(NOC 72404) ë“± ìš´ì†¡ ì§êµ°ì€ ê°€ì¥ ë†’ì€ ë¹ˆë„ë¡œ ì„ ë°œë  ì˜ˆì •ì…ë‹ˆë‹¤. í•´ì™¸ ìê²©ì¦ì˜ ìºë‚˜ë‹¤ í™˜ì‚° ì ˆì°¨ë¥¼ ë¯¸ë¦¬ ì™„ë£Œí•˜ëŠ” ê²ƒì´ í•„ìˆ˜ì…ë‹ˆë‹¤.</p>`
    },
    {
        title: "êµ­ë°© ë° êµ°ì‚¬ ê¸°ìˆ ì§(Military) ì‹ ì„¤ ì¹´í…Œê³ ë¦¬ ì™„ë²½ ë¶„ì„",
        badge: "ì‹ ê·œ ì „í˜•",
        date: "2026ë…„ 2ì›” 21ì¼",
        content: `<p>êµ°ì—ì„œì˜ íŠ¹ìˆ˜ ê¸°ìˆ (ì‚¬ì´ë²„ ë³´ì•ˆ, íŠ¹ìˆ˜ ì¥ë¹„ ì •ë¹„ ë“±)ì´ ìºë‚˜ë‹¤ ì•ˆë³´ì˜ í•µì‹¬ ìì‚°ìœ¼ë¡œ ì¸ì •ë°›ìŠµë‹ˆë‹¤. ìš°ë°©êµ­ êµ° ê²½ë ¥ìì—ê²Œ ê°•ë ¥í•œ ê°€ì ì´ ë¶€ì—¬ë˜ëŠ” í˜ì‹ ì ì¸ ì „í˜•ì…ë‹ˆë‹¤.</p>`
    },
    {
        title: "í”„ë‘ìŠ¤ì–´ ìš°ìˆ˜ì ì „í˜•: 2026ë…„ì—ë„ ì˜ì£¼ê¶Œ ì·¨ë“ì˜ 'ì¹˜íŠ¸í‚¤'",
        badge: "ì–¸ì–´ ì „ëµ",
        date: "2026ë…„ 2ì›” 20ì¼",
        content: `<p>ë¶ˆì–´ ëŠ¥ë ¥(CLB 7 ì´ìƒ)ì€ ì¼ë°˜ ì„ ë°œë³´ë‹¤ 100ì  ì´ìƒ ë‚®ì€ ì»¤íŠ¸ë¼ì¸ í˜œíƒì„ ì œê³µí•©ë‹ˆë‹¤. ì˜ì–´ ì„±ì ê³¼ ì¡°í•© ì‹œ ìµœëŒ€ 50ì  ì¶”ê°€ ì ìˆ˜ë¥¼ í™•ë³´í•  ìˆ˜ ìˆëŠ” ê°€ì¥ í™•ì‹¤í•œ ê²½ë¡œì…ë‹ˆë‹¤.</p>`
    }
];

// --- Comprehensive NOC 2021 Database (200+ Unit Groups) ---
const nocData = [
    // Category 0 - Management
    { code: "00010", title: "Legislators", teer: "0", cat: "" },
    { code: "00011", title: "Senior government managers and officials", teer: "0", cat: "" },
    { code: "00012", title: "Senior managers - financial, communications", teer: "0", cat: "Management" },
    { code: "00013", title: "Senior managers - health, education", teer: "0", cat: "Management" },
    { code: "00014", title: "Senior managers - trade, broadcasting", teer: "0", cat: "Management" },
    { code: "00015", title: "Senior managers - construction, transportation", teer: "0", cat: "Management" },
    { code: "10010", title: "Financial managers", teer: "0", cat: "" },
    { code: "10011", title: "Human resources managers", teer: "0", cat: "" },
    { code: "10012", title: "Purchasing managers", teer: "0", cat: "" },
    { code: "10019", title: "Other administrative services managers", teer: "0", cat: "" },
    { code: "10020", title: "Insurance, real estate managers", teer: "0", cat: "" },
    { code: "10021", title: "Banking, credit and investment managers", teer: "0", cat: "" },
    { code: "10022", title: "Advertising, marketing and PR managers", teer: "0", cat: "" },
    { code: "20010", title: "Engineering managers", teer: "0", cat: "STEM" },
    { code: "20011", title: "Architecture and science managers", teer: "0", cat: "STEM" },
    { code: "20012", title: "Computer and information systems managers", teer: "0", cat: "STEM" },
    { code: "30010", title: "Managers in health care", teer: "0", cat: "Healthcare" },
    { code: "40010", title: "Government managers - health/social policy", teer: "0", cat: "" },
    { code: "40020", title: "Administrators - post-secondary education", teer: "0", cat: "Academic" },
    { code: "60010", title: "Corporate sales managers", teer: "0", cat: "" },
    { code: "60020", title: "Retail and wholesale trade managers", teer: "0", cat: "" },
    { code: "60030", title: "Restaurant and food service managers", teer: "0", cat: "" },
    { code: "70010", title: "Construction managers", teer: "0", cat: "" },
    { code: "70020", title: "Managers in transportation", teer: "0", cat: "Transport" },
    { code: "80010", title: "Managers in natural resources and fishing", teer: "0", cat: "" },
    { code: "90010", title: "Manufacturing managers", teer: "0", cat: "" },

    // Category 1 - Business & Finance
    { code: "11100", title: "Financial auditors and accountants", teer: "1", cat: "" },
    { code: "11101", title: "Financial and investment analysts", teer: "1", cat: "" },
    { code: "11102", title: "Financial advisors", teer: "1", cat: "" },
    { code: "11200", title: "Human resources professionals", teer: "1", cat: "" },
    { code: "11201", title: "Business management consulting professionals", teer: "1", cat: "" },
    { code: "11202", title: "Advertising, marketing and PR professionals", teer: "1", cat: "" },
    { code: "12010", title: "General office supervisors", teer: "2", cat: "" },
    { code: "12100", title: "Administrative officers", teer: "2", cat: "" },
    { code: "12101", title: "Executive assistants", teer: "2", cat: "" },
    { code: "12102", title: "Procurement and purchasing agents", teer: "2", cat: "" },
    { code: "12200", title: "Accounting technicians and bookkeepers", teer: "2", cat: "" },
    { code: "13100", title: "Administrative assistants", teer: "3", cat: "" },
    { code: "13110", title: "Administrative accounts payroll", teer: "3", cat: "" },
    { code: "13111", title: "Property administrators", teer: "3", cat: "" },

    // Category 2 - STEM
    { code: "21100", title: "Physicists and astronomers", teer: "1", cat: "STEM" },
    { code: "21101", title: "Chemists", teer: "1", cat: "STEM" },
    { code: "21110", title: "Biologists and related scientists", teer: "1", cat: "STEM" },
    { code: "21200", title: "Architects", teer: "1", cat: "STEM" },
    { code: "21201", title: "Landscape architects", teer: "1", cat: "STEM" },
    { code: "21211", title: "Data scientists", teer: "1", cat: "STEM" },
    { code: "21220", title: "Cybersecurity specialists", teer: "1", cat: "STEM" },
    { code: "21221", title: "Business systems specialists", teer: "1", cat: "STEM" },
    { code: "21222", title: "Information systems specialists", teer: "1", cat: "STEM" },
    { code: "21223", title: "Database analysts and administrators", teer: "1", cat: "STEM" },
    { code: "21230", title: "Computer systems developers", teer: "1", cat: "STEM" },
    { code: "21231", title: "Software engineers and designers", teer: "1", cat: "STEM" },
    { code: "21232", title: "Software developers and programmers", teer: "1", cat: "STEM" },
    { code: "21233", title: "Web designers", teer: "1", cat: "STEM" },
    { code: "21234", title: "Web developers and programmers", teer: "1", cat: "STEM" },
    { code: "21300", title: "Civil engineers", teer: "1", cat: "STEM" },
    { code: "21301", title: "Mechanical engineers", teer: "1", cat: "STEM" },
    { code: "21310", title: "Electrical and electronics engineers", teer: "1", cat: "STEM" },
    { code: "21311", title: "Computer engineers (except software)", teer: "1", cat: "STEM" },
    { code: "21320", title: "Chemical engineers", teer: "1", cat: "STEM" },
    { code: "21321", title: "Industrial and manufacturing engineers", teer: "1", cat: "STEM" },
    { code: "22100", title: "Chemical technologists and technicians", teer: "2", cat: "STEM" },
    { code: "22210", title: "Architectural technologists and technicians", teer: "2", cat: "STEM" },
    { code: "22220", title: "Computer network and web technicians", teer: "2", cat: "STEM" },
    { code: "22221", title: "User support technicians", teer: "2", cat: "STEM" },
    { code: "22230", title: "Civil engineering technologists", teer: "2", cat: "STEM" },
    { code: "22231", title: "Mechanical engineering technologists", teer: "2", cat: "STEM" },

    // Category 3 - Healthcare
    { code: "31100", title: "Specialists in clinical medicine", teer: "1", cat: "Healthcare" },
    { code: "31101", title: "Specialists in surgery", teer: "1", cat: "Healthcare" },
    { code: "31102", title: "General practitioners and family physicians", teer: "1", cat: "Healthcare" },
    { code: "31103", title: "Veterinarians", teer: "1", cat: "" },
    { code: "31110", title: "Dentists", teer: "1", cat: "Healthcare" },
    { code: "31111", title: "Optometrists", teer: "1", cat: "Healthcare" },
    { code: "31120", title: "Pharmacists", teer: "1", cat: "Healthcare" },
    { code: "31121", title: "Dietitians and nutritionists", teer: "1", cat: "Healthcare" },
    { code: "31200", title: "Psychologists", teer: "1", cat: "Healthcare" },
    { code: "31201", title: "Chiropractors", teer: "1", cat: "Healthcare" },
    { code: "31202", title: "Physiotherapists", teer: "1", cat: "Healthcare" },
    { code: "31203", title: "Occupational therapists", teer: "1", cat: "Healthcare" },
    { code: "31301", title: "Registered nurses and psychiatric nurses", teer: "1", cat: "Healthcare" },
    { code: "31302", title: "Nurse practitioners", teer: "1", cat: "Healthcare" },
    { code: "32101", title: "Licensed practical nurses (LPN)", teer: "2", cat: "Healthcare" },
    { code: "32102", title: "Paramedical occupations", teer: "2", cat: "Healthcare" },
    { code: "32103", title: "Respiratory therapists", teer: "2", cat: "Healthcare" },
    { code: "32111", title: "Dental hygienists and therapists", teer: "2", cat: "Healthcare" },
    { code: "32120", title: "Medical laboratory technologists", teer: "2", cat: "Healthcare" },
    { code: "32124", title: "Pharmacy technicians", teer: "2", cat: "Healthcare" },
    { code: "33100", title: "Dental assistants", teer: "3", cat: "Healthcare" },
    { code: "33102", title: "Nurse aides and orderlies", teer: "3", cat: "Healthcare" },

    // Category 4 - Education & Social
    { code: "41101", title: "Lawyers and Quebec notaries", teer: "1", cat: "" },
    { code: "41200", title: "University professors and lecturers", teer: "1", cat: "Academic" },
    { code: "41201", title: "Post-secondary teaching and research assistants", teer: "1", cat: "Academic" },
    { code: "41210", title: "College and other vocational instructors", teer: "1", cat: "Academic" },
    { code: "41220", title: "Secondary school teachers", teer: "1", cat: "" },
    { code: "41221", title: "Elementary school and kindergarten teachers", teer: "1", cat: "" },
    { code: "41300", title: "Social workers", teer: "1", cat: "Healthcare" },
    { code: "41301", title: "Therapists in counselling", teer: "1", cat: "Healthcare" },
    { code: "42201", title: "Social and community service workers", teer: "2", cat: "Healthcare" },
    { code: "42202", title: "Early childhood educators (ECE)", teer: "2", cat: "" },
    { code: "43100", title: "Legal assistants and paralegals", teer: "3", cat: "" },

    // Category 5 - Arts & Culture
    { code: "51101", title: "Painters, sculptors and visual artists", teer: "1", cat: "" },
    { code: "51111", title: "Librarians", teer: "1", cat: "" },
    { code: "52100", title: "Writers and editors", teer: "2", cat: "" },
    { code: "52120", title: "Graphic designers and illustrators", teer: "2", cat: "" },
    { code: "52121", title: "Interior designers", teer: "2", cat: "" },
    { code: "53100", title: "Photographers", teer: "3", cat: "" },

    // Category 6 - Sales & Service
    { code: "62010", title: "Retail sales supervisors", teer: "2", cat: "" },
    { code: "62020", title: "Food service supervisors", teer: "2", cat: "" },
    { code: "62200", title: "Chefs", teer: "2", cat: "Trades" },
    { code: "63200", title: "Cooks", teer: "3", cat: "Trades" },
    { code: "63201", title: "Butchers", teer: "3", cat: "Trades" },
    { code: "63202", title: "Bakers", teer: "3", cat: "Trades" },
    { code: "63211", title: "Hairstylists and barbers", teer: "3", cat: "" },

    // Category 7 - Trades & Transport
    { code: "72010", title: "Contractors and supervisors, machining trades", teer: "2", cat: "Trades" },
    { code: "72011", title: "Contractors and supervisors, electrical trades", teer: "2", cat: "Trades" },
    { code: "72013", title: "Contractors and supervisors, carpentry trades", teer: "2", cat: "Trades" },
    { code: "72100", title: "Machinists and machining inspectors", teer: "2", cat: "Trades" },
    { code: "72106", title: "Welders and related operators", teer: "2", cat: "Trades" },
    { code: "72200", title: "Electricians (except power system)", teer: "2", cat: "Trades" },
    { code: "72201", title: "Industrial electricians", teer: "2", cat: "Trades" },
    { code: "72300", title: "Plumbers", teer: "2", cat: "Trades" },
    { code: "72310", title: "Carpenters", teer: "2", cat: "Trades" },
    { code: "72400", title: "Construction millwrights and industrial mechanics", teer: "2", cat: "Trades" },
    { code: "72401", title: "Heavy-duty equipment mechanics", teer: "2", cat: "Trades" },
    { code: "72402", title: "Heating and air conditioning (HVAC) mechanics", teer: "2", cat: "Trades" },
    { code: "72404", title: "Aircraft mechanics and inspectors", teer: "2", cat: "Transport" },
    { code: "72410", title: "Automotive service technicians", teer: "2", cat: "Trades" },
    { code: "72500", title: "Crane operators", teer: "2", cat: "Trades" },
    { code: "72600", title: "Air pilots and flight engineers", teer: "2", cat: "Transport" },
    { code: "72601", title: "Air traffic controllers", teer: "2", cat: "Transport" },
    { code: "72602", title: "Deck officers, water transport", teer: "2", cat: "Transport" },
    { code: "73110", title: "Roofers and shinglers", teer: "3", cat: "Trades" },
    { code: "73300", title: "Transport truck drivers", teer: "3", cat: "Transport" },
    { code: "73301", title: "Bus and transit operators", teer: "3", cat: "Transport" },

    // 8/9 - Natural Resources & Manufacturing
    { code: "82010", title: "Agricultural service farm supervisors", teer: "2", cat: "" },
    { code: "92010", title: "Supervisors, mineral and metal processing", teer: "2", cat: "" },
    { code: "92100", title: "Power engineers and systems operators", teer: "2", cat: "" }
];

// --- Functional Logic ---
window.filterNOC = function() {
    const input = document.getElementById('nocSearchInput').value.toLowerCase().trim();
    const resultsContainer = document.getElementById('nocResults');
    if (input.length < 2) {
        resultsContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--text-muted);">ì˜ë¬¸ í‚¤ì›Œë“œë¥¼ 2ê¸€ì ì´ìƒ ì…ë ¥í•˜ì„¸ìš”.</p>';
        return;
    }
    const keywords = input.split(' ');
    const filtered = nocData.filter(item => {
        const fullContent = (item.title + " " + item.code + " " + (item.cat || "")).toLowerCase();
        return keywords.every(kw => fullContent.includes(kw));
    });
    if (filtered.length === 0) {
        resultsContainer.innerHTML = '<p style="text-align: center; padding: 20px; color: var(--text-muted);">ì¼ì¹˜í•˜ëŠ” ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ì˜ë¬¸ í‚¤ì›Œë“œ(e.g. Developer, Cook)ë¡œ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.</p>';
        return;
    }
    resultsContainer.innerHTML = filtered.map(item => `
        <div class="noc-item">
            <div class="noc-header">
                <span class="noc-code">${item.code}</span>
                <span class="noc-teer">TEER ${item.teer}</span>
                ${item.cat ? `<span class="noc-cat-badge">${item.cat}</span>` : ''}
            </div>
            <div class="noc-title">${item.title}</div>
        </div>
    `).join('');
};

window.openArticle = function(index) {
    const article = articlesData[index];
    if (!article) return;
    const modal = document.getElementById("articleModal");
    const modalBody = document.getElementById("modalBody");
    if (!modal || !modalBody) return;
    modalBody.innerHTML = `<span class="article-badge">${article.badge}</span><h2>${article.title}</h2><div class="article-meta">${article.date}</div><div class="full-content">${article.content}</div><button class="read-more-btn" style="margin-top:30px; width:100%" id="modalCloseBtn">ë‹«ê¸°</button>`;
    modal.style.display = "block";
    document.body.classList.add("modal-open");
    document.getElementById("modalCloseBtn").onclick = window.closeArticle;
};

window.closeArticle = function() {
    const modal = document.getElementById("articleModal");
    if (modal) { modal.style.display = "none"; document.body.classList.remove("modal-open"); }
};

document.addEventListener('DOMContentLoaded', () => {
    const nav = document.getElementById('mainNav');
    if (nav) {
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) { nav.style.padding = '8px 20px'; nav.style.top = '10px'; }
            else { nav.style.padding = '12px 30px'; nav.style.top = '20px'; }
        });
    }
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
        if (document.documentElement.getAttribute('data-theme') === 'dark') themeToggle.textContent = 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
        themeToggle.addEventListener('click', () => {
            let theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            themeToggle.textContent = theme === 'dark' ? 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
        });
    }
    renderPosts();
    window.addEventListener('click', (e) => { if (e.target === document.getElementById("articleModal")) window.closeArticle(); });
    window.addEventListener('keydown', (e) => { if (e.key === "Escape") window.closeArticle(); });
});

function calculateCRS() {
    const status = document.getElementById('maritalStatus').value;
    const isMarried = (status === 'married');
    const age = parseInt(document.getElementById("age").value) || 0;
    const education = document.getElementById("education").value;
    const language = parseInt(document.getElementById("language").value) || 0;
    const canadianExp = parseInt(document.getElementById("canadianExp").value) || 0;
    const foreignExp = parseInt(document.getElementById("foreignExp").value) || 0;
    const canadianStudy = parseInt(document.getElementById("canadianStudy").value) || 0;
    const pnp = parseInt(document.getElementById("pnp").value) || 0;
    const jobOffer = parseInt(document.getElementById("jobOffer").value) || 0;
    const sibling = parseInt(document.getElementById("sibling").value) || 0;
    const frenchSkill = parseInt(document.getElementById("frenchSkill").value) || 0;

    let total = 0;
    let agePoints = 0;
    if (age >= 20 && age <= 29) agePoints = isMarried ? 100 : 110;
    else if (age >= 30 && age <= 44) {
        let base = isMarried ? 100 : 110;
        let deduct = isMarried ? 5 : 6;
        agePoints = base - ((age - 29) * deduct);
    }
    total += Math.max(0, agePoints);

    const eduMap = { 'highschool': isMarried ? 28 : 30, 'bachelor': isMarried ? 112 : 120, 'two_or_more': isMarried ? 119 : 128, 'master': isMarried ? 126 : 135, 'phd': isMarried ? 140 : 150 };
    total += eduMap[education] || 0;

    const langMap = { 7: isMarried ? 64 : 68, 8: isMarried ? 88 : 92, 9: isMarried ? 116 : 124, 10: isMarried ? 128 : 136 };
    total += langMap[language] || 0;

    const canExpMap = { 1: isMarried ? 35 : 40, 2: isMarried ? 46 : 53, 3: isMarried ? 70 : 80 };
    total += canExpMap[canadianExp] || 0;

    if (isMarried) {
        const sEdu = document.getElementById("spouseEducation").value;
        const sLang = parseInt(document.getElementById("spouseLanguage").value) || 0;
        if (sEdu === 'bachelor') total += 8; else if (sEdu === 'master') total += 10;
        if (sLang >= 9) total += 20; else if (sLang >= 7) total += 12; else if (sLang >= 5) total += 4;
    }

    let transfer = 0;
    if (education !== 'highschool' && education !== '0') {
        if (language >= 9) transfer += (education === 'master' || education === 'phd' ? 50 : 25);
        else if (language >= 7) transfer += (education === 'master' || education === 'phd' ? 25 : 13);
    }
    if (canadianExp >= 1 && foreignExp >= 1) {
        if (canadianExp >= 2) transfer += (foreignExp >= 3 ? 50 : 25);
        else transfer += (foreignExp >= 3 ? 25 : 13);
    } else if (foreignExp >= 1 && language >= 7) {
        if (language >= 9) transfer += (foreignExp >= 3 ? 50 : 25);
        else transfer += (foreignExp >= 3 ? 25 : 13);
    }
    total += Math.min(100, transfer);
    total += (canadianStudy + jobOffer + sibling + frenchSkill + pnp);

    const res = document.getElementById("crsResult");
    res.querySelector('.result-score').innerText = Math.min(1200, total) + "ì ";
    res.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function addPost() {
    let t = document.getElementById("title");
    let c = document.getElementById("content");
    if(!t.value || !c.value) return;
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.push({title: t.value, content: c.value});
    localStorage.setItem("posts", JSON.stringify(posts));
    t.value = ""; c.value = "";
    renderPosts();
}

function renderPosts() {
    let list = document.getElementById("blogList");
    if(!list) return;
    list.innerHTML = "";
    let posts = JSON.parse(localStorage.getItem("posts")) || [];
    posts.reverse().forEach(p => {
        let d = document.createElement("div");
        d.className = "blog-post card";
        d.style.padding = "20px";
        d.innerHTML = `<h3>${p.title}</h3><p>${p.content}</p>`;
        list.appendChild(d);
    });
}
